---
import CookieConsent from '../components/CookieConsent.astro';

interface Props {
  title: string;
  description: string;
  ogImage?: string;
}

const { title, description, ogImage = '/og-image.jpg' } = Astro.props;

const GTM_ID = import.meta.env.GTM_ID || 'GTM-XXXXXX';
---

<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <meta name="robots" content="index, follow" />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:type" content="website" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin />
    <link rel="preconnect" href="https://connect.facebook.net" crossorigin />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />
    <link rel="preconnect" href="https://i.ytimg.com" crossorigin />

    <!-- Preload critical hero image -->
    <link rel="preload" href="/images/hero-teacher.webp" as="image" type="image/webp" fetchpriority="high" />

    <!-- Google Fonts with display=swap and preload -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fraunces:wght@400;500;600;700&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'" />
    <noscript><link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Fraunces:wght@400;500;600;700&display=swap" rel="stylesheet" /></noscript>

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <title>{title}</title>

    <script is:inline define:vars={{ GTM_ID }}>
      window.dataLayer = window.dataLayer || [];
      const urlParams = new URLSearchParams(window.location.search);
      const utmData = {
        utm_source: urlParams.get('utm_source') || '(direct)',
        utm_medium: urlParams.get('utm_medium') || '(none)',
        utm_campaign: urlParams.get('utm_campaign') || '(not set)',
        utm_content: urlParams.get('utm_content') || '',
        utm_term: urlParams.get('utm_term') || ''
      };
      const clickIds = {
        gclid: urlParams.get('gclid') || '',
        gbraid: urlParams.get('gbraid') || '',
        wbraid: urlParams.get('wbraid') || '',
        ttclid: urlParams.get('ttclid') || '',
        fbclid: urlParams.get('fbclid') || ''
      };
      sessionStorage.setItem('utmData', JSON.stringify(utmData));
      Object.entries(clickIds).forEach(([key, value]) => {
        if (value) sessionStorage.setItem(key, value);
      });
      window.dataLayer.push({
        'event': 'page_data',
        ...utmData,
        ...clickIds,
        'page_path': window.location.pathname,
        'page_title': document.title,
        'page_referrer': document.referrer
      });
      // Defer GTM loading to not block rendering
      function loadGTM() {
        (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer', GTM_ID);
      }
      if (window.requestIdleCallback) {
        requestIdleCallback(loadGTM);
      } else {
        setTimeout(loadGTM, 1);
      }
    </script>

    <style is:global>
      :root {
        /* Premium Color Palette */
        --color-primary: #0055cc;
        --color-primary-dark: #003d99;
        --color-primary-light: #3377dd;
        --color-primary-subtle: #e6f0ff;

        --color-accent: #ffc629;
        --color-accent-dark: #e6b000;
        --color-accent-glow: rgba(255, 198, 41, 0.3);

        --color-dark: #0a1628;
        --color-dark-soft: #1a2a42;

        --color-gray-900: #0f172a;
        --color-gray-800: #1e293b;
        --color-gray-700: #334155;
        --color-gray-600: #475569;
        --color-gray-500: #64748b;
        --color-gray-400: #94a3b8;
        --color-gray-300: #cbd5e1;
        --color-gray-200: #e2e8f0;
        --color-gray-100: #f1f5f9;
        --color-gray-50: #f8fafc;

        --color-white: #ffffff;
        --color-success: #10b981;
        --color-error: #ef4444;

        /* Typography */
        --font-display: 'Fraunces', Georgia, serif;
        --font-body: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;

        /* Spacing */
        --section-padding: clamp(4rem, 10vw, 7rem);
        --container-max: 1280px;
        --container-padding: clamp(1.25rem, 5vw, 3rem);

        /* Borders */
        --radius-sm: 6px;
        --radius-md: 12px;
        --radius-lg: 20px;
        --radius-xl: 28px;
        --radius-full: 9999px;

        /* Shadows */
        --shadow-sm: 0 1px 3px rgba(10, 22, 40, 0.04);
        --shadow-md: 0 4px 16px rgba(10, 22, 40, 0.08);
        --shadow-lg: 0 12px 40px rgba(10, 22, 40, 0.12);
        --shadow-xl: 0 24px 60px rgba(10, 22, 40, 0.16);
        --shadow-glow: 0 0 60px rgba(0, 85, 204, 0.15);
        --shadow-accent: 0 8px 32px rgba(255, 198, 41, 0.25);

        /* Transitions */
        --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
        --ease-out-quart: cubic-bezier(0.25, 1, 0.5, 1);
        --transition-fast: 150ms var(--ease-out-quart);
        --transition-base: 300ms var(--ease-out-expo);
        --transition-slow: 500ms var(--ease-out-expo);
      }

      *, *::before, *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html {
        scroll-behavior: smooth;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body {
        font-family: var(--font-body);
        font-size: 17px;
        line-height: 1.7;
        color: var(--color-gray-700);
        background-color: var(--color-white);
        overflow-x: hidden;
      }

      h1, h2, h3, h4, h5, h6 {
        font-family: var(--font-display);
        font-weight: 600;
        line-height: 1.2;
        color: var(--color-dark);
        letter-spacing: -0.02em;
      }

      img {
        max-width: 100%;
        height: auto;
        display: block;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      button {
        font-family: inherit;
        cursor: pointer;
        border: none;
        background: none;
      }

      input, textarea, select {
        font-family: inherit;
        font-size: inherit;
      }

      .container {
        width: 100%;
        max-width: var(--container-max);
        margin: 0 auto;
        padding: 0 var(--container-padding);
      }

      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Premium Animations */
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes shimmer {
        0% { background-position: -200% 0; }
        100% { background-position: 200% 0; }
      }

      @keyframes float {
        0%, 100% { transform: translateY(0) rotate(0deg); }
        50% { transform: translateY(-12px) rotate(1deg); }
      }

      @keyframes pulse-glow {
        0%, 100% { box-shadow: 0 0 0 0 var(--color-accent-glow); }
        50% { box-shadow: 0 0 40px 10px var(--color-accent-glow); }
      }

      .animate-fade-up {
        animation: fadeUp 0.8s var(--ease-out-expo) forwards;
        opacity: 0;
      }

      .animate-fade-in {
        animation: fadeIn 0.6s var(--ease-out-quart) forwards;
        opacity: 0;
      }

      .animate-scale-in {
        animation: scaleIn 0.6s var(--ease-out-expo) forwards;
        opacity: 0;
      }

      .delay-1 { animation-delay: 0.1s; }
      .delay-2 { animation-delay: 0.2s; }
      .delay-3 { animation-delay: 0.3s; }
      .delay-4 { animation-delay: 0.4s; }
      .delay-5 { animation-delay: 0.5s; }

      /* Noise texture overlay */
      .noise-overlay::before {
        content: '';
        position: absolute;
        inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        opacity: 0.03;
        pointer-events: none;
        z-index: 1;
      }

      /* Gradient text */
      .gradient-text {
        background: linear-gradient(135deg, var(--color-accent) 0%, #ffdd66 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Selection */
      ::selection {
        background: var(--color-primary);
        color: white;
      }
    </style>
  </head>
  <body>
    <noscript>
      <iframe
        src={`https://www.googletagmanager.com/ns.html?id=${GTM_ID}`}
        height="0"
        width="0"
        style="display:none;visibility:hidden">
      </iframe>
    </noscript>

    <slot />

    <CookieConsent />

    <script is:inline>
      // Intersection Observer for scroll animations
      (function() {
        const observerOptions = {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        }, observerOptions);

        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
      })();
    </script>
  </body>
</html>
